<!DOCTYPE html>
<html>
<head>
    <title>Свара</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 20px;
        }
        h2 {
            color: #e74c3c;
            font-size: 1.8em;
            margin-top: 20px;
        }
        p {
            font-size: 1.2em;
            margin: 10px 0;
        }
        .stage-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .player-hand {
            padding: 15px;
            margin: 10px 0;
            background-color: #ecf0f1;
            border-left: 5px solid #3498db;
            border-radius: 5px;
        }
        .player-hand.inactive {
            background-color: #bdc3c7;
            border-left-color: #7f8c8d;
        }
        form {
            display: inline-block;
            margin: 10px 0;
        }
        input[type="number"] {
            padding: 8px;
            font-size: 1em;
            border: 1px solid #ccc;
            border-radius: 5px;
            width: 100px;
        }
        button {
            padding: 10px 20px;
            font-size: 1em;
            color: #fff;
            background-color: #3498db;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        button[name="action"][value="fold"] {
            background-color: #e74c3c;
        }
        button[name="action"][value="fold"]:hover {
            background-color: #c0392b;
        }
        .winner {
            font-weight: bold;
            color: #27ae60;
            font-size: 1.3em;
            margin-top: 20px;
        }
        .cards {
            font-size: 1.2em;
            color: #8e44ad;
        }
    </style>
</head>
<body>
    <h1>Игра: {{ game.id }} - {{ game.get_stage_display }}</h1>

    <div class="stage-container">
        {% if game.stage == 'deal' %}
            <p>Картите са раздадени. Готови ли сте да започнете залагането?</p>
            <form method="post">
                {% csrf_token %}
                <button type="submit">Започни залагане</button>
            </form>

        {% elif game.stage == 'betting' %}
            <h2>Залагане</h2>
            {% for hand in hands %}
                <div class="player-hand {% if not hand.is_active %}inactive{% endif %}">
                    {% if hand.is_active %}
                        <p>{{ hand.player.name }} (Чипове: {{ hand.player.chips }}) - Текущ залог: {{ hand.bet }}</p>
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="player_id" value="{{ hand.player.id }}">
                            <input type="number" name="bet" min="0" max="{{ hand.player.chips }}" placeholder="Залог">
                            <button type="submit" name="action" value="bet">Заложи</button>
                            <button type="submit" name="action" value="fold">Откажи се</button>
                        </form>
                    {% else %}
                        <p>{{ hand.player.name }} - Отказал се</p>
                    {% endif %}
                </div>
            {% endfor %}

        {% elif game.stage == 'showdown' %}
            <h2>Резултати</h2>
            {% for hand in hands %}
                <div class="player-hand">
                    <p>{{ hand.player.name }}:
                        <span class="cards">{% for card in hand.cards.all %}{{ card }} {% endfor %}</span>
                        - Точки: {{ scores|dictsort:hand.player.name|first|last }}
                    </p>
                </div>
            {% endfor %}
            {% if winner %}
                <p class="winner">Победител: {{ winner }} (Взима пота: {{ game.pot }})</p>
            {% else %}
                <p>Няма победител</p>
            {% endif %}
        {% endif %}
    </div>
</body>
</html>